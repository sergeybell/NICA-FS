INCLUDE 'bin/support/support';


PROCEDURE RUN;
  VARIABLE RESTMASSAMU 1; VARIABLE GAMMA 1; VARIABLE EKIN 1;
  VARIABLE WHERE 100;
  VARIABLE QF  1; VARIABLE QD  1;
  VARIABLE HZ1 1; VARIABLE HZ2 1;
  VARIABLE KZ1 1; VARIABLE KZ2 1;
  VARIABLE MAPPARAMS 1 6; {HOLDS THE ABOVE VALUES}
  VARIABLE MAPARR 1000 6 471; VARIABLE SPNRARR 1000 3 3 471;

  VARIABLE I 1;

  DIRSET WHERE 'data/ELEMENT_MAPS/' TRUE;
  
  OV 1 3 0;
  RESTMASSAMU := 1.00728;
  GAMMA := 1.14;
  EKIN := (GAMMA-1)*RESTMASSAMU*AMUMEV;
  WRITE 6 'EKIN = '&ST(EKIN);
  RP EKIN RESTMASSAMU 1; {inject protons}
  RPS 0 1.792847; {deuteron G = -.142987}

  {LATTICE PARAMETERS:}
  IF M0<2; SET_FOR_PROTONS HZ1 HZ2 QF QD; WRITE 6 'SETUP FOR PROTONS';
  ELSEIF TRUE; SET_FOR_DEUTERONS HZ1 HZ2 QF QD; WRITE 6 'SETUP FOR DEUTERONS';
  ENDIF;

  MAPPARAMS(1) := HZ1; MAPPARAMS(2) := HZ2;
  MAPPARAMS(3) := KZ1; MAPPARAMS(4) := KZ2;
  MAPPARAMS(5) := QF;  MAPPARAMS(6) := QD;

  MAPSEQ24BENDS MAPPARAMS MAPARR SPNRARR;

  LOOP I 1 471;
    OPENF 5315 WHERE&'ELEM_'&MRK(I) 'REPLACE';
      RMAPS I MAPARR SPNRARR;
      PM 5315;
    CLOSEF 5315;
  ENDLOOP;

ENDPROCEDURE;

RUN; END;
